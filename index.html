<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S&P 500 Treemap</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <div class="header-left">
            <div class="title-row">
                <div class="raccoon-container" id="raccoon">
                    <div class="raccoon-awake" id="raccoon-awake">
                        <svg viewBox="0 0 64 64" width="48" height="48">
                            <!-- Face -->
                            <ellipse cx="32" cy="36" rx="20" ry="18" fill="#8B8B8B"/>
                            <!-- Ears -->
                            <ellipse cx="16" cy="18" rx="8" ry="10" fill="#4A4A4A"/>
                            <ellipse cx="48" cy="18" rx="8" ry="10" fill="#4A4A4A"/>
                            <ellipse cx="16" cy="18" rx="5" ry="7" fill="#FFB6C1"/>
                            <ellipse cx="48" cy="18" rx="5" ry="7" fill="#FFB6C1"/>
                            <!-- Face mask -->
                            <ellipse cx="32" cy="34" rx="16" ry="12" fill="#D3D3D3"/>
                            <!-- Eye masks (black patches) -->
                            <ellipse cx="24" cy="32" rx="7" ry="5" fill="#2D2D2D"/>
                            <ellipse cx="40" cy="32" rx="7" ry="5" fill="#2D2D2D"/>
                            <!-- Eyes (awake - open) -->
                            <ellipse cx="24" cy="32" rx="4" ry="4" fill="#FFFFFF"/>
                            <ellipse cx="40" cy="32" rx="4" ry="4" fill="#FFFFFF"/>
                            <circle cx="25" cy="32" r="2" fill="#1a1a1a"/>
                            <circle cx="41" cy="32" r="2" fill="#1a1a1a"/>
                            <circle cx="25.5" cy="31.5" r="0.8" fill="#FFFFFF"/>
                            <circle cx="41.5" cy="31.5" r="0.8" fill="#FFFFFF"/>
                            <!-- Nose -->
                            <ellipse cx="32" cy="40" rx="3" ry="2" fill="#2D2D2D"/>
                            <!-- Mouth -->
                            <path d="M 29 44 Q 32 47 35 44" stroke="#2D2D2D" stroke-width="1.5" fill="none"/>
                        </svg>
                    </div>
                    <div class="raccoon-asleep" id="raccoon-asleep" style="display: none;">
                        <svg viewBox="0 0 64 64" width="48" height="48">
                            <!-- Face -->
                            <ellipse cx="32" cy="36" rx="20" ry="18" fill="#8B8B8B"/>
                            <!-- Ears -->
                            <ellipse cx="16" cy="18" rx="8" ry="10" fill="#4A4A4A"/>
                            <ellipse cx="48" cy="18" rx="8" ry="10" fill="#4A4A4A"/>
                            <ellipse cx="16" cy="18" rx="5" ry="7" fill="#FFB6C1"/>
                            <ellipse cx="48" cy="18" rx="5" ry="7" fill="#FFB6C1"/>
                            <!-- Face mask -->
                            <ellipse cx="32" cy="34" rx="16" ry="12" fill="#D3D3D3"/>
                            <!-- Eye masks (black patches) -->
                            <ellipse cx="24" cy="32" rx="7" ry="5" fill="#2D2D2D"/>
                            <ellipse cx="40" cy="32" rx="7" ry="5" fill="#2D2D2D"/>
                            <!-- Eyes (asleep - closed lines) -->
                            <path d="M 20 32 Q 24 34 28 32" stroke="#FFFFFF" stroke-width="2" fill="none" stroke-linecap="round"/>
                            <path d="M 36 32 Q 40 34 44 32" stroke="#FFFFFF" stroke-width="2" fill="none" stroke-linecap="round"/>
                            <!-- Zzz -->
                            <text x="50" y="20" fill="#6B9BD2" font-size="10" font-weight="bold">z</text>
                            <text x="54" y="14" fill="#6B9BD2" font-size="8" font-weight="bold">z</text>
                            <text x="57" y="9" fill="#6B9BD2" font-size="6" font-weight="bold">z</text>
                            <!-- Nose -->
                            <ellipse cx="32" cy="40" rx="3" ry="2" fill="#2D2D2D"/>
                            <!-- Mouth (slight smile while sleeping) -->
                            <path d="M 30 44 Q 32 45 34 44" stroke="#2D2D2D" stroke-width="1.5" fill="none"/>
                        </svg>
                    </div>
                </div>
                <h1>S&P 500 Treemap</h1>
            </div>
            <p class="subtitle">Stock performance by market cap and sector <span class="market-status" id="market-status"></span></p>
        </div>
        <div class="search-container">
            <input type="text" id="stock-search" placeholder="Search ticker or company..." autocomplete="off">
            <div id="search-results" class="search-results"></div>
        </div>
        <div class="index-trackers">
            <div class="index-item">
                <span class="index-name">S&P 500</span>
                <span class="index-change positive">+0.82%</span>
            </div>
            <div class="index-item">
                <span class="index-name">NASDAQ</span>
                <span class="index-change positive">+1.24%</span>
            </div>
        </div>
    </div>
    <div class="legend">
        <span class="legend-item"><span class="legend-color" style="background: #0d5f2a;"></span> +3%+</span>
        <span class="legend-item"><span class="legend-color" style="background: #1a8f3e;"></span> +2%</span>
        <span class="legend-item"><span class="legend-color" style="background: #2ecc71;"></span> +1%</span>
        <span class="legend-item"><span class="legend-color" style="background: #58d68d;"></span> +0.5%</span>
        <span class="legend-item"><span class="legend-color" style="background: #8fe0ac;"></span> 0%</span>
        <span class="legend-item"><span class="legend-color" style="background: #f5a8a2;"></span> -0.5%</span>
        <span class="legend-item"><span class="legend-color" style="background: #e67e73;"></span> -1%</span>
        <span class="legend-item"><span class="legend-color" style="background: #c0392b;"></span> -2%</span>
        <span class="legend-item"><span class="legend-color" style="background: #7b241c;"></span> -3%+</span>
    </div>
    <div class="main-content">
        <div id="treemap"></div>
        
        <!-- Stock Detail Panel (slides in from right) -->
        <div id="stock-panel" class="stock-panel">
            <div class="panel-header">
                <button class="panel-close">&larr; Back</button>
                <div class="stock-title">
                    <span class="stock-ticker">AAPL</span>
                    <span class="stock-sector">Technology</span>
                </div>
            </div>
            
            <div class="panel-content">
                <div class="stock-hero">
                    <div class="stock-name-full">Apple Inc.</div>
                    <div class="current-price">
                        <span class="price-value">$178.52</span>
                        <span class="price-change positive">+2.35 (+1.33%)</span>
                    </div>
                    <div class="price-details">
                        <span class="price-detail">After Hours: <span class="ah-price">$178.80</span> <span class="ah-change positive">+0.28 (+0.16%)</span></span>
                    </div>
                </div>
                
                <div class="chart-section">
                    <div class="time-selector">
                        <button class="time-btn" data-period="1D">1D</button>
                        <button class="time-btn" data-period="1W">1W</button>
                        <button class="time-btn active" data-period="1M">1M</button>
                        <button class="time-btn" data-period="3M">3M</button>
                        <button class="time-btn" data-period="1Y">1Y</button>
                        <button class="time-btn" data-period="5Y">5Y</button>
                    </div>
                    <div id="stock-chart"></div>
                    <div class="chart-stats">
                        <div class="chart-stat">
                            <span class="stat-label">Period High</span>
                            <span class="stat-value" id="chart-high">$182.34</span>
                        </div>
                        <div class="chart-stat">
                            <span class="stat-label">Period Low</span>
                            <span class="stat-value" id="chart-low">$165.12</span>
                        </div>
                        <div class="chart-stat">
                            <span class="stat-label">Period Change</span>
                            <span class="stat-value positive" id="chart-change">+8.2%</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Today's Trading</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Open</span>
                            <span class="info-value" id="metric-open">$176.15</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">High</span>
                            <span class="info-value" id="metric-high">$179.23</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Low</span>
                            <span class="info-value" id="metric-low">$175.82</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Prev Close</span>
                            <span class="info-value" id="metric-prevclose">$176.17</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Volume</span>
                            <span class="info-value" id="metric-volume">52.3M</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Avg Volume</span>
                            <span class="info-value" id="metric-avgvol">58.2M</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>52 Week Range</h3>
                    <div class="range-container">
                        <div class="range-bar">
                            <div class="range-fill" id="range-fill"></div>
                            <div class="range-marker" id="range-marker"></div>
                        </div>
                        <div class="range-labels">
                            <span class="range-low" id="metric-52low">$124.17</span>
                            <span class="range-high" id="metric-52high">$198.23</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Valuation</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Market Cap</span>
                            <span class="info-value" id="metric-marketcap">$2.89T</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Enterprise Value</span>
                            <span class="info-value" id="metric-ev">$2.95T</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">P/E Ratio (TTM)</span>
                            <span class="info-value" id="metric-pe">29.45</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Forward P/E</span>
                            <span class="info-value" id="metric-forwardpe">26.82</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">PEG Ratio</span>
                            <span class="info-value" id="metric-peg">2.45</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Price/Sales</span>
                            <span class="info-value" id="metric-ps">7.52</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Price/Book</span>
                            <span class="info-value" id="metric-pb">45.82</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">EV/EBITDA</span>
                            <span class="info-value" id="metric-evebitda">22.15</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Financials (Quarterly)</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Revenue</span>
                            <span class="info-value" id="metric-revenue">$94.8B</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Revenue Growth (YoY)</span>
                            <span class="info-value positive" id="metric-revgrowth">+2.1%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Gross Profit</span>
                            <span class="info-value" id="metric-grossprofit">$42.3B</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Gross Margin</span>
                            <span class="info-value" id="metric-grossmargin">44.6%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Operating Income</span>
                            <span class="info-value" id="metric-opincome">$28.5B</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Operating Margin</span>
                            <span class="info-value" id="metric-opmargin">30.1%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Net Income</span>
                            <span class="info-value" id="metric-netincome">$23.0B</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Profit Margin</span>
                            <span class="info-value" id="metric-margin">24.3%</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Per Share Data</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">EPS (TTM)</span>
                            <span class="info-value" id="metric-eps">$6.06</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">EPS Growth (YoY)</span>
                            <span class="info-value positive" id="metric-epsgrowth">+10.8%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Book Value/Share</span>
                            <span class="info-value" id="metric-bookvalue">$3.90</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Cash/Share</span>
                            <span class="info-value" id="metric-cashpershare">$4.15</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Dividends & Returns</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Dividend (Annual)</span>
                            <span class="info-value" id="metric-divannual">$0.96</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Dividend Yield</span>
                            <span class="info-value" id="metric-divyield">0.51%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Payout Ratio</span>
                            <span class="info-value" id="metric-payout">15.8%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Ex-Dividend Date</span>
                            <span class="info-value" id="metric-exdiv">Feb 9, 2024</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ROE</span>
                            <span class="info-value" id="metric-roe">147.2%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ROA</span>
                            <span class="info-value" id="metric-roa">28.5%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ROIC</span>
                            <span class="info-value" id="metric-roic">52.3%</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Balance Sheet</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Total Cash</span>
                            <span class="info-value" id="metric-cash">$65.4B</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Total Debt</span>
                            <span class="info-value" id="metric-debt">$109.3B</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Net Debt</span>
                            <span class="info-value" id="metric-netdebt">$43.9B</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Debt/Equity</span>
                            <span class="info-value" id="metric-debtequity">1.81</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Current Ratio</span>
                            <span class="info-value" id="metric-currentratio">0.99</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Quick Ratio</span>
                            <span class="info-value" id="metric-quickratio">0.84</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Trading Information</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Beta</span>
                            <span class="info-value" id="metric-beta">1.28</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Shares Outstanding</span>
                            <span class="info-value" id="metric-sharesout">15.6B</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Float</span>
                            <span class="info-value" id="metric-float">15.5B</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Short Interest</span>
                            <span class="info-value" id="metric-shortint">0.72%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Inst. Ownership</span>
                            <span class="info-value" id="metric-instown">60.2%</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Insider Ownership</span>
                            <span class="info-value" id="metric-insiderown">0.07%</span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>Analyst Ratings</h3>
                    <div class="analyst-summary">
                        <div class="analyst-rating">
                            <span class="rating-label">Consensus</span>
                            <span class="rating-value buy" id="analyst-rating">Buy</span>
                        </div>
                        <div class="analyst-target">
                            <span class="target-label">Price Target</span>
                            <span class="target-value" id="analyst-target">$195.50</span>
                            <span class="target-upside positive" id="analyst-upside">(+9.5% upside)</span>
                        </div>
                    </div>
                    <div class="analyst-breakdown">
                        <div class="rating-bar">
                            <div class="rating-segment strong-buy" id="seg-strongbuy" style="width: 35%"></div>
                            <div class="rating-segment buy" id="seg-buy" style="width: 45%"></div>
                            <div class="rating-segment hold" id="seg-hold" style="width: 15%"></div>
                            <div class="rating-segment sell" id="seg-sell" style="width: 5%"></div>
                            <div class="rating-segment strong-sell" id="seg-strongsell" style="width: 0%"></div>
                        </div>
                        <div class="rating-labels">
                            <span>Strong Buy: <span id="cnt-strongbuy">14</span></span>
                            <span>Buy: <span id="cnt-buy">18</span></span>
                            <span>Hold: <span id="cnt-hold">6</span></span>
                            <span>Sell: <span id="cnt-sell">2</span></span>
                        </div>
                    </div>
                </div>
                
                <div class="info-section company-info">
                    <h3>About</h3>
                    <p class="company-description" id="company-description">
                        Apple Inc. designs, manufactures, and markets smartphones, personal computers, tablets, wearables, and accessories worldwide. The company offers iPhone, Mac, iPad, and wearables, home and accessories. It also provides AppleCare support and cloud services, and operates various platforms including the App Store.
                    </p>
                    <div class="company-details">
                        <div class="detail-item">
                            <span class="detail-label">Headquarters</span>
                            <span class="detail-value" id="company-hq">Cupertino, CA</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Employees</span>
                            <span class="detail-value" id="company-employees">164,000</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Founded</span>
                            <span class="detail-value" id="company-founded">1976</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">CEO</span>
                            <span class="detail-value" id="company-ceo">Tim Cook</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="tooltip" class="tooltip"></div>
    
    <script src="data.js"></script>
    <script src="stockData.js"></script>
    <script src="api.js"></script>
    <script src="treemap.js"></script>
    <script src="stockDetail.js"></script>
</body>
</html>
